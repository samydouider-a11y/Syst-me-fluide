<!doctype html>
<html lang="fr">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MusclePilot â€” Dark Knight</title>
<link rel="manifest" href="manifest.json"/><meta name="theme-color" content="#00a8ff"/>
<style>
/* Batman tech theme */
:root{--bg:#0a0e18;--panel:#0b1325;--border:#12203a;--muted:#7a8aa6;--white:#e6eefc;--blue:#00a8ff;--yellow:#ffc700;--danger:#ff4d4d;--ok:#1be48b}
*{box-sizing:border-box} body{margin:0;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;background:
radial-gradient(1000px 600px at 70% 10%, rgba(0,168,255,.10), rgba(0,0,0,0)),
radial-gradient(800px 500px at 20% 80%, rgba(255,199,0,.08), rgba(0,0,0,0)),var(--bg);color:var(--white)}
.wrap{max-width:1100px;margin:0 auto;padding:16px}
.header{display:flex;align-items:center;justify-content:space-between;margin:8px 0 16px}
.title{font-weight:900;font-size:22px;background:linear-gradient(90deg,var(--blue),#73e0ff,var(--yellow));-webkit-background-clip:text;background-clip:text;color:transparent}
.pill{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--muted);font-size:12px}
.tabs{display:flex;gap:8px;flex-wrap:wrap}.tab{padding:10px 14px;border:1px solid var(--border);background:rgba(255,255,255,.02);border-radius:12px;color:var(--white);cursor:pointer}
.tab.active{outline:1px solid #1f2d4a;background:linear-gradient(180deg,#0f1b33,#0b1325)}
.card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 0 0 1px rgba(0,168,255,.04) inset}
.grid{display:grid;gap:12px}@media(min-width:760px){.grid.cols-2{grid-template-columns:1fr 1fr}.grid.cols-3{grid-template-columns:1fr 1fr 1fr}}
label{display:block;font-size:12px;color:var(--muted);margin-bottom:4px} input,select{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#091020;color:var(--white)}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}.btn{padding:10px 14px;border:1px solid var(--border);background:#0e1830;color:var(--white);border-radius:10px;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--blue),#73e0ff);color:#051024;border-color:#167fb1}.btn.warn{background:linear-gradient(90deg,#33220a,#5a4200);color:#ffd56b}
.tile{display:flex;align-items:center;justify-content:space-between;border:1px solid var(--border);border-radius:14px;padding:10px;background:#0c162a}
.ok{background:rgba(27,228,139,.1);border-color:rgba(27,228,139,.25)}.low{background:rgba(255,77,77,.12);border-color:rgba(255,77,77,.25)}.high{background:rgba(255,199,0,.12);border-color:rgba(255,199,0,.25)}
.muted{color:var(--muted)} .splash{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:
radial-gradient(600px 350px at 50% 60%, rgba(0,168,255,.16), rgba(0,0,0,0)),linear-gradient(180deg,var(--bg) 0%, #0b1220 100%);z-index:50;animation:fadeOut 1.4s ease .4s forwards}
.logo{display:flex;align-items:center;gap:12px;background:rgba(255,255,255,.06);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.15);padding:12px 16px;border-radius:16px}
.logo b{background:linear-gradient(90deg,var(--blue),#73e0ff,var(--yellow));-webkit-background-clip:text;background-clip:text;color:transparent;font-size:18px}
@keyframes fadeOut{to{opacity:0;visibility:hidden}} .hint{font-size:12px;color:var(--muted);margin-top:4px}
</style>
<script>if('serviceWorker' in navigator){window.addEventListener('load',()=>navigator.serviceWorker.register('sw.js'));}</script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@zxing/library@latest"></script>
</head>
<body><div id="root"></div>
<div id="splash" class="splash"><div class="logo"><img src="icons/icon-192x192.png" width="28" height="28" alt="logo"/><div><b>MusclePilot</b><div class="muted" style="font-size:12px;margin-top:-2px">Dark Knight</div></div><div style="font-size:12px;margin-left:8px;color:#00a8ff">Bootingâ€¦ ðŸ¦‡</div></div></div>
<script type="text/babel">
const {useState,useEffect,useMemo,useRef}=React;
const round=(n,d=0)=>Number(n.toFixed(d));
function useLocal(key,init){const [v,setV]=useState(()=>{try{const raw=localStorage.getItem(key);return raw?JSON.parse(raw):init}catch{return init}});useEffect(()=>{try{localStorage.setItem(key,JSON.stringify(v))}catch{}},[key,v]);return [v,setV]}
const dayKey=(d=new Date())=>d.toISOString().slice(0,10);
const defaultProfile={sex:'M',age:31,heightCm:184,weightKg:79.2,sessionsPerWeek:4,activityFactor:1.6,goal:'recomp',deficitPct:0.10};
const BMR=p=> (10*p.weightKg+6.25*p.heightCm-5*p.age+(p.sex==='F'?-161:5));
function macro(p){const b=BMR(p),t=b*p.activityFactor;let target=t;if(p.goal==='recomp')target=t*(1-(p.deficitPct??0.10));if(p.goal==='cut')target=t*0.85;if(p.goal==='bulk')target=t*1.08;return {bmr:Math.round(b),tdee:Math.round(t),target:Math.round(target)}}
function stepLengthCm(h){return round(0.415*(h||175),0)};function paceToMET(kmh){if(kmh<=3)return 2.3;if(kmh<=4)return 2.9;if(kmh<=5)return 3.5;if(kmh<=6)return 4.3;if(kmh<=7)return 5;return 7}
function kcalPerStepEstimate(profile,paceKmh){const met=paceToMET(paceKmh||4.5);const kg=profile.weightKg||80;const stepLen=stepLengthCm(profile.heightCm||180)/100;const stepsPerMin=(paceKmh||4.5)*1000/60/stepLen;const kcalPerMin=met*3.5*kg/200;return kcalPerMin/stepsPerMin}
async function scanBarcode(videoEl,onResult,onError){try{const cr=new ZXing.BrowserMultiFormatReader();const devices=await cr.listVideoInputDevices();const deviceId=devices[0]?.deviceId;await cr.decodeOnceFromVideoDevice(deviceId,videoEl,(res,err)=>{if(res){onResult(res.text);cr.reset()} if(err && !(err instanceof ZXing.NotFoundException)){onError?.(String(err))}})}catch(e){onError?.(String(e))}}
async function fetchOFF(barcode){const url=`https://world.openfoodfacts.org/api/v2/product/${encodeURIComponent(barcode)}.json`;try{const r=await fetch(url);const j=await r.json();if(j&&j.product){const p=j.product;return {name:p.product_name||'Produit OFF',kcalPer100:+p.nutriments['energy-kcal_100g']||null,proteinPer100:+p.nutriments['proteins_100g']||0,carbsPer100:+p.nutriments['carbohydrates_100g']||0,fatPer100:+p.nutriments['fat_100g']||0}}}catch(e){}return null}
function Tabs({active,onSet}){const items=[["tracker","Calories & Pas"],["profile","Profil"],["sync","Sync"],["coach","Coaching"],["export","Export"]];return <div className="tabs">{items.map(([k,lab])=><button key={k} className={"tab"+(active===k?" active":"")} onClick={()=>onSet(k)}>{lab}</button>)}</div>}
function App(){const [tab,setTab]=useState("tracker");const [profile,setProfile]=useLocal("mp_dark_prof",defaultProfile);const base=macro(profile);
const [cfg,setCfg]=useLocal("mp_dark_cfg",{paceKmh:4.8,kcalPerStep:null});const [days,setDays]=useLocal("mp_dark_days",{});
const [coach,setCoach]=useLocal("mp_dark_coach",{enabled:true,lowThresh:-200,highThresh:150});
const [sync,setSync]=useLocal("mp_dark_sync",{mode:"none",supabaseUrl:"",supabaseAnon:"",table:"musclepilot_logs",sheetsWebhook:""});
useEffect(()=>{const t=setTimeout(()=>{const el=document.getElementById("splash");if(navigator.vibrate)try{navigator.vibrate(15)}catch{};if(el)el.style.display="none"},900);return ()=>clearTimeout(t)},[]);
const k=dayKey();const day=days[k]||{foods:[],steps:0,kcalPerStep:cfg.kcalPerStep};
const est=cfg.kcalPerStep??kcalPerStepEstimate(profile,cfg.paceKmh);const stepsKcal=Math.round((day.steps||0)*est);const dynamicTarget=Math.round(base.target+stepsKcal);
const totals=day.foods.reduce((a,f)=>({kcal:a.kcal+(+f.kcal||0),p:a.p+(+f.protein||0),c:a.c+(+f.carbs||0),f:a.f+(+f.fat||0)}),{kcal:0,p:0,c:0,f:0});
const remaining=Math.round(dynamicTarget-totals.kcal);
function saveDay(u){setDays(prev=>({...prev,[k]:{...day,...u}}))} function addFood(food){saveDay({foods:[...(day.foods||[]),{...food,id:Date.now()}]})}
function removeFood(id){saveDay({foods:(day.foods||[]).filter(f=>f.id!==id)})}
useEffect(()=>{if(!coach.enabled)return;if(remaining<=coach.lowThresh){notify("âš ï¸ Sous la cible",`Il te manque ${Math.abs(remaining)} kcal.`)}else if(remaining>=coach.highThresh){notify("ðŸ”” Auâ€‘dessus",`Tu dÃ©passes de ${remaining} kcal.`)}},[remaining,coach.enabled]);
function notify(title,body){try{if(navigator.vibrate)navigator.vibrate([10,40,10]);if("Notification"in window){if(Notification.permission==="granted"){new Notification(title,{body,icon:"icons/icon-192x192.png"})}else if(Notification.permission!=="denied"){Notification.requestPermission()}}}catch{}}
async function syncPushAll(){const payload={profile,cfg,coach,days};if(sync.mode==="supabase"){try{const {supabaseUrl,supabaseAnon,table}=sync;if(!supabaseUrl||!supabaseAnon||!table){alert("Config Supabase incomplÃ¨te.");return}
const res=await fetch(`${supabaseUrl}/rest/v1/${table}`,{method:"POST",headers:{"Content-Type":"application/json","apikey":supabaseAnon,"Authorization":`Bearer ${supabaseAnon}`,"Prefer":"resolution=merge-duplicates"},body:JSON.stringify([{id:"singleton",data:payload}])});if(!res.ok)throw new Error("HTTP "+res.status);alert("Synchronisation Supabase OK.")}catch(e){alert("Erreur Supabase: "+e.message)}}
else if(sync.mode==="sheets"){try{if(!sync.sheetsWebhook){alert("Webhook Google Apps Script manquant.");return}const res=await fetch(sync.sheetsWebhook,{method:"POST",body:JSON.stringify(payload)});if(!res.ok)throw new Error("HTTP "+res.status);alert("Synchronisation Sheets OK.")}catch(e){alert("Erreur Sheets: "+e.message)}}else{alert("Sync dÃ©sactivÃ©e.")}}
return (<div className="wrap">
  <div className="header"><div className="title">MusclePilot â€” Dark Knight</div><div className="pill">Jour {k} <span style={{marginLeft:6,color:'#00a8ff'}}>ðŸ¦‡ Gotham Tech</span></div></div>
  <Tabs active={tab} onSet={setTab}/>
  {tab==="tracker" && (<div className="card">
    <b>Pas & Cible dynamique</b>
    <div className="grid cols-3">
      <div className="tile"><span className="muted">Pas du jour</span><div className="row"><input type="number" value={day.steps} onChange={e=>saveDay({steps:+e.target.value})}/></div></div>
      <div className="tile"><span className="muted">Allure (km/h)</span><div className="row"><input type="number" step="0.1" value={cfg.paceKmh} onChange={e=>setCfg({...cfg,paceKmh:+e.target.value})}/></div><div className="hint">Impacte lâ€™estimation kcal/pas.</div></div>
      <div className="tile"><span className="muted">kcal / pas (estimÃ©)</span><b>{round(est,3)}</b></div>
    </div>
    <div className="grid cols-3" style={{marginTop:12}}>
      <div className="tile"><span className="muted">Cible repos</span><b>{base.target} kcal</b></div>
      <div className="tile"><span className="muted">kcal des pas</span><b>{stepsKcal} kcal</b></div>
      <div className="tile"><span className="muted">Cible ajustÃ©e</span><b>{dynamicTarget} kcal</b></div>
    </div>
    <div className="card" style={{marginTop:12}}>
      <b>Ajouter un aliment</b>
      <FoodForm onAdd={addFood}/>
      <div className="grid cols-2" style={{marginTop:12}}><BarcodeBlock onAdd={addFood}/><PhotoBlock onAdd={addFood}/></div>
    </div>
    <div className="card"><b>Aliments du jour</b>
      {(!day.foods||day.foods.length===0)&&<div className="muted">Aucun aliment ajoutÃ©.</div>}
      {(day.foods||[]).map(f=>(<div key={f.id} className="tile" style={{margin:"6px 0"}}>
        <div><div><b>{f.name||"Aliment"}</b> {f.grams?<span className="muted">({f.grams} g)</span>:null}</div>
          <div className="muted" style={{fontSize:12}}>{Math.round(f.kcal)} kcal Â· P {f.protein} g Â· G {f.carbs} g Â· L {f.fat} g {f.barcode?`Â· code ${f.barcode}`:""}</div></div>
        <div className="row">{f.photoDataUrl?<a className="btn" href={f.photoDataUrl} target="_blank" rel="noreferrer">Photo</a>:null}<button className="btn" onClick={()=>removeFood(f.id)}>Supprimer</button></div>
      </div>))}
    </div>
    <div className="grid cols-3" style={{marginTop:12}}>
      <div className="tile"><span className="muted">Total kcal</span><b>{Math.round((day.foods||[]).reduce((s,f)=>s+(+f.kcal||0),0))}</b></div>
      <div className="tile"><span className="muted">Reste</span><b style={{color:remaining<0?'var(--danger)':'var(--ok)'}}>{remaining}</b></div>
      <div className="tile"><span className="muted">BMR/TDEE</span><b>{base.bmr} / {base.tdee}</b></div>
    </div>
  </div>)}
  {tab==="profile" && (<div className="card"><b>Profil</b>
    <div className="grid cols-2">
      <div><label>Taille (cm)</label><input type="number" value={profile.heightCm} onChange={e=>setProfile({...profile,heightCm:+e.target.value})}/></div>
      <div><label>Poids (kg)</label><input type="number" step="0.1" value={profile.weightKg} onChange={e=>setProfile({...profile,weightKg:+e.target.value})}/></div>
      <div><label>Ã‚ge</label><input type="number" value={profile.age} onChange={e=>setProfile({...profile,age:+e.target.value})}/></div>
      <div><label>Sexe</label><select value={profile.sex} onChange={e=>setProfile({...profile,sex:e.target.value})}><option value="M">Homme</option><option value="F">Femme</option></select></div>
      <div><label>Objectif</label><select value={profile.goal} onChange={e=>setProfile({...profile,goal:e.target.value})}><option value="recomp">Recomposition</option><option value="cut">SÃ¨che</option><option value="bulk">Prise de masse</option></select></div>
      <div><label>DÃ©ficit (%)</label><input type="number" value={Math.round((profile.deficitPct||0.10)*100)} onChange={e=>setProfile({...profile,deficitPct:(+e.target.value||0)/100})}/></div>
      <div><label>ActivitÃ© (facteur)</label><select value={String(profile.activityFactor)} onChange={e=>setProfile({...profile,activityFactor:+e.target.value})}>{[1.2,1.375,1.55,1.6,1.725,1.9].map(v=><option key={v} value={v}>{v}</option>)}</select></div>
    </div></div>)}
  {tab==="sync" && (<div className="card"><b>Synchronisation</b>
    <div className="row"><label>Mode</label><select value={sync.mode} onChange={e=>setSync({...sync,mode:e.target.value})}><option value="none">DÃ©sactivÃ©</option><option value="supabase">Supabase</option><option value="sheets">Google Sheets (webhook)</option></select>
      <button className="btn primary" onClick={async()=>{await (async function(){const payload={profile,cfg,coach,days};if(sync.mode==="supabase"){try{const {supabaseUrl,supabaseAnon,table}=sync;if(!supabaseUrl||!supabaseAnon||!table){alert("Config Supabase incomplÃ¨te.");return}
      const res=await fetch(`${supabaseUrl}/rest/v1/${table}`,{method:"POST",headers:{"Content-Type":"application/json","apikey":supabaseAnon,"Authorization":`Bearer ${supabaseAnon}`,"Prefer":"resolution=merge-duplicates"},body:JSON.stringify([{id:"singleton",data:payload}])});if(!res.ok)throw new Error("HTTP "+res.status);alert("Supabase OK")}catch(e){alert("Erreur Supabase: "+e.message)}} else if(sync.mode==="sheets"){try{if(!sync.sheetsWebhook){alert("Webhook manquant.");return}const res=await fetch(sync.sheetsWebhook,{method:"POST",body:JSON.stringify(payload)});if(!res.ok)throw new Error("HTTP "+res.status);alert("Sheets OK")}catch(e){alert("Erreur Sheets: "+e.message)}} else {alert("Sync dÃ©sactivÃ©e.")}})()}}>Pousser les donnÃ©es</button></div>
    {sync.mode==="supabase" && (<div className="grid cols-2" style={{marginTop:10}}>
      <div><label>Supabase URL</label><input value={sync.supabaseUrl} onChange={e=>setSync({...sync,supabaseUrl:e.target.value})} placeholder="https://YOUR-PROJECT.supabase.co"/></div>
      <div><label>Anon Key</label><input value={sync.supabaseAnon} onChange={e=>setSync({...sync,supabaseAnon:e.target.value})} placeholder="ey..."/></div>
      <div><label>Table</label><input value={sync.table} onChange={e=>setSync({...sync,table:e.target.value})} placeholder="musclepilot_logs"/></div>
      <div className="hint">Table REST : id text (PK), data jsonb. Ligne unique id='singleton'.</div>
    </div>)}
    {sync.mode==="sheets" && (<div className="grid cols-2" style={{marginTop:10}}>
      <div><label>Webhook (Apps Script)</label><input value={sync.sheetsWebhook} onChange={e=>setSync({...sync,sheetsWebhook:e.target.value})} placeholder="https://script.google.com/macros/s/XXXX/exec"/></div>
      <div className="hint">Apps Script: doPost(e){ const body=JSON.parse(e.postData.contents); /* write to sheet */ }</div>
    </div>)}
  </div>)}
  {tab==="coach" && (<div className="card"><b>Coaching</b>
    <div className="row"><label>Activer</label><select value={String(coach.enabled)} onChange={e=>setCoach({...coach,enabled:e.target.value==='true'})}><option value="true">Oui</option><option value="false">Non</option></select></div>
    <div className="grid cols-2" style={{marginTop:10}}>
      <div><label>Alerte quand Reste â‰¤</label><input type="number" value={coach.lowThresh} onChange={e=>setCoach({...coach,lowThresh:+e.target.value})}/></div>
      <div><label>Alerte quand Reste â‰¥</label><input type="number" value={coach.highThresh} onChange={e=>setCoach({...coach,highThresh:+e.target.value})}/></div>
    </div>
    <div className="hint">Notifications locales + vibration (si autorisÃ©es).</div>
  </div>)}
  {tab==="export" && (<div className="card"><b>Export</b>
    <div className="row">
      <button className="btn" onClick={()=>{const rows=[["Date","Food","Grams","kcal","Protein","Carbs","Fat","Barcode"],["","PROFILE","",JSON.stringify(profile),"","","",""],["","PACE_KMH","",cfg.paceKmh,"","","",""],["","KCAL_PER_STEP","",(cfg.kcalPerStep??kcalPerStepEstimate(profile,cfg.paceKmh)).toFixed(5),"","","",""],["","TARGET_REST","",macro(profile).target,"","","",""]];Object.entries(days).forEach(([dk,d])=>{(d.foods||[]).forEach(f=>rows.push([dk,f.name||"",f.grams||"",f.kcal||"",f.protein||"",f.carbs||"",f.fat||"",f.barcode||""]))});const csv=rows.map(r=>r.join(",")).join("\n");const blob=new Blob([csv],{type:"text/csv;charset=utf-8;"});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='musclepilot_dark_knight.csv';a.click();URL.revokeObjectURL(url);}}>TÃ©lÃ©charger CSV</button>
      <button className="btn warn" onClick={()=>{if(confirm("RÃ©initialiser le journal (conserver le profil) ?")){localStorage.removeItem('mp_dark_days');location.reload()}}}>RÃ©initialiser</button>
    </div>
  </div>)}
</div>)}
function FoodForm({onAdd}){const [name,setName]=useState(""),[kcal,setKcal]=useState(""),[p,setP]=useState(""),[c,setC]=useState(""),[f,setF]=useState(""),[g,setG]=useState("");return (<div className="grid cols-3">
  <div><label>Nom</label><input value={name} onChange={e=>setName(e.target.value)} placeholder="Aliment"/></div>
  <div><label>kcal</label><input type="number" value={kcal} onChange={e=>setKcal(+e.target.value)}/></div>
  <div><label>Prot (g)</label><input type="number" value={p} onChange={e=>setP(+e.target.value)}/></div>
  <div><label>Gluc (g)</label><input type="number" value={c} onChange={e=>setC(+e.target.value)}/></div>
  <div><label>Lip (g)</label><input type="number" value={f} onChange={e=>setF(+e.target.value)}/></div>
  <div><label>Grammage (g)</label><input type="number" value={g} onChange={e=>setG(+e.target.value)}/></div>
  <div className="row" style={{alignItems:'end'}}><button className="btn primary" onClick={()=>{onAdd({name,kcal:+kcal||0,protein:+p||0,carbs:+c||0,fat:+f||0,grams:+g||null});setName("");setKcal("");setP("");setC("");setF("");setG("")}}>Ajouter</button></div>
</div>)}
function BarcodeBlock({onAdd}){const [barcode,setBarcode]=useState(""),[status,setStatus]=useState("PrÃªt");const videoRef=useRef(null),[grams,setGrams]=useState(100);
async function doScan(){setStatus("Scan en coursâ€¦");scanBarcode(videoRef.current,(code)=>{setBarcode(code);setStatus("Code dÃ©tectÃ© : "+code)},(err)=>setStatus("Erreur: "+err))}
async function lookup(){try{setStatus("Recherche OFFâ€¦");const info=await fetchOFF(barcode);if(!info){setStatus("Produit non trouvÃ©");return}setStatus("TrouvÃ© : "+(info.name||""));
const factor=(+grams||100)/100;onAdd({name:info.name||"Produit OFF",kcal:(info.kcalPer100||0)*factor,protein:(info.proteinPer100||0)*factor,carbs:(info.carbsPer100||0)*factor,fat:(info.fatPer100||0)*factor,grams:+grams||100,barcode})}catch(e){setStatus("Erreur OFF")}}
return (<div className="card"><b>Scan codeâ€‘barres</b><div className="row" style={{marginTop:6}}><button className="btn" onClick={doScan}>Activer la camÃ©ra</button><input placeholder="Codeâ€‘barres" value={barcode} onChange={e=>setBarcode(e.target.value)}/><input type="number" value={grams} onChange={e=>setGrams(+e.target.value)}/><span className="muted">g</span><button className="btn primary" onClick={lookup}>Ajouter depuis OFF</button></div><video ref={videoRef} style={{width:"100%",border:"1px solid var(--border)",borderRadius:8,marginTop:8}} muted playsInline></video><div className="hint">{status}</div></div>)}
function PhotoBlock({onAdd}){const [photo,setPhoto]=useState(null),[preset,setPreset]=useState("none"),[grams,setGrams]=useState(300),[kcal,setKcal]=useState(0),[p,setP]=useState(0),[c,setC]=useState(0),[f,setF]=useState(0);
useEffect(()=>{const per100={"none":{k:0,p:0,c:0,f:0},"chicken_rice":{k:165,p:31,c:0,f:3.6},"pasta_bolo":{k:150,p:7,c:22,f:4},"salmon_potatoes":{k:200,p:18,c:10,f:10},"salad_olive":{k:120,p:3,c:10,f:8}}[preset];const factor=(+grams||100)/100;setKcal(Math.round(per100.k*factor));setP(Number((per100.p*factor).toFixed(1)));setC(Number((per100.c*factor).toFixed(1)));setF(Number((per100.f*factor).toFixed(1)))},[preset,grams]);
function onFile(e){const file=e.target.files?.[0];if(!file)return;const rdr=new FileReader();rdr.onload=()=>setPhoto(rdr.result);rdr.readAsDataURL(file)}
return (<div className="card"><b>Photo du plat (estimation)</b><div className="grid cols-3" style={{marginTop:6}}>
  <div><label>Photo</label><input type="file" accept="image/*" onChange={onFile}/></div>
  <div><label>Preset</label><select value={preset} onChange={e=>setPreset(e.target.value)}><option value="none">â€”</option><option value="chicken_rice">Poulet & riz (100g)</option><option value="pasta_bolo">PÃ¢tes bolo (100g)</option><option value="salmon_potatoes">Saumon & pommes (100g)</option><option value="salad_olive">Salade + huile (100g)</option></select></div>
  <div><label>Grammage (g)</label><input type="number" value={grams} onChange={e=>setGrams(+e.target.value)}/></div>
  <div><label>kcal</label><input type="number" value={kcal} onChange={e=>setKcal(+e.target.value)}/></div>
  <div><label>Prot (g)</label><input type="number" value={p} onChange={e=>setP(+e.target.value)}/></div>
  <div><label>Gluc (g)</label><input type="number" value={c} onChange={e=>setC(+e.target.value)}/></div>
  <div><label>Lip (g)</label><input type="number" value={f} onChange={e=>setF(+e.target.value)}/></div>
</div><div className="row" style={{marginTop:8}}><button className="btn primary" onClick={()=>onAdd({name:"Plat (photo)",grams,kcal,protein:p,carbs:c,fat:f,photoDataUrl:photo})}>Ajouter le plat</button>{photo?<a className="btn" href={photo} target="_blank" rel="noreferrer">Voir photo</a>:null}</div></div>)}
const root=ReactDOM.createRoot(document.getElementById('root'));root.render(<App/>);
</script>
</body></html>