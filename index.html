<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MusclePilot â€” MINI (Batman)</title>
<style>
  :root{--bg:#0a0e18;--panel:#0b1325;--panel2:#0d1730;--border:#12203a;--muted:#7a8aa6;--white:#e6eefc;--blue:#00a8ff;--yellow:#ffc700;--ok:#1be48b;--warn:#ffb300;--bad:#ff5757}
  *{box-sizing:border-box} body{margin:0;background:radial-gradient(900px 550px at 70% 5%, rgba(0,168,255,.08),transparent),radial-gradient(700px 500px at 15% 85%, rgba(255,199,0,.06),transparent),var(--bg);color:var(--white);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .hdr{display:flex;align-items:center;justify-content:space-between;margin:8px 0 14px}
  .title{font-weight:900;font-size:22px;letter-spacing:.2px;background:linear-gradient(90deg,var(--blue),#73e0ff,var(--yellow));-webkit-background-clip:text;background-clip:text;color:transparent}
  .badge{border:1px solid var(--border);background:var(--panel2);padding:8px 10px;border-radius:12px;font-size:12px;color:var(--muted)}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
  .tab{padding:10px 14px;border:1px solid var(--border);background:#0e1830;border-radius:12px;color:#fff;cursor:pointer}
  .tab.active{outline:1px solid #20304f;background:linear-gradient(180deg,#0f1b33,#0b1325)}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px;margin:12px 0}
  .grid{display:grid;gap:10px}
  @media(min-width:760px){.grid.c2{grid-template-columns:1fr 1fr}.grid.c3{grid-template-columns:1fr 1fr 1fr}.grid.c4{grid-template-columns:1fr 1fr 1fr 1fr}}
  label{display:block;font-size:12px;color:var(--muted);margin-bottom:4px}
  input,select{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#091020;color:#fff}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{padding:10px 14px;border:1px solid var(--border);background:#0e1830;color:#fff;border-radius:10px;cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,var(--blue),#73e0ff);color:#051024;border-color:#167fb1}
  .pill{font-size:11px;border:1px solid var(--border);padding:2px 8px;border-radius:999px;background:#0b1429;color:var(--muted)}
  .tile{display:flex;align-items:center;justify-content:space-between;border:1px solid var(--border);border-radius:12px;padding:10px;background:#0c162a}
  .small{font-size:12px;color:var(--muted)}
  .advice.ok{color:var(--ok)} .advice.warn{color:var(--warn)} .advice.bad{color:var(--bad)} .advice.neut{color:#c8d4f0}
  .hr{height:1px;background:linear-gradient(90deg,transparent,#162644,transparent);margin:10px 0}
  .setbox{border:1px dashed #234;border-radius:10px;padding:8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="hdr"><div class="title">MusclePilot â€” MINI (Batman)</div><div class="badge">ðŸ¦‡ Gotham Tech</div></div>
  <div id="tabs" class="tabs"></div>

  <div id="view-program" class="card" style="display:none"></div>
  <div id="view-log" class="card" style="display:none"></div>
  <div id="view-advice" class="card" style="display:none"></div>
  <div id="view-export" class="card" style="display:none"></div>
</div>

<script>
(function(){
  const LS_PLAN = "mp_mini_plan_v1";
  const LS_LOGS = "mp_mini_logs_v1"; // structure: { "2025-W44": { dayIdx: { exName: [ {set,weight,reps,date} ] } } }
  const TABS = [
    ["program","Programme"],
    ["log","SÃ©ances"],
    ["advice","Conseils"],
    ["export","Export"]
  ];

  // ---- Data model
  const PLAN_DEFAULT = [
    { name: "Upper â€” Push", ex: [
      { n: "Bench Press", sets: 4, rr:[6,8] },
      { n: "Incline DB Press", sets: 3, rr:[8,10] },
      { n: "Dips", sets: 3, rr:[8,12] },
      { n: "Overhead DB Press", sets: 3, rr:[8,12] },
      { n: "Lateral Raises", sets: 3, rr:[12,15] },
      { n: "Plank", sets: 3, rr:[45,60] },
    ]},
    { name: "Lower â€” Quads", ex: [
      { n: "Back Squat", sets: 4, rr:[6,8] },
      { n: "Walking Lunge", sets: 3, rr:[10,10] },
      { n: "Leg Press", sets: 3, rr:[10,12] },
      { n: "Leg Extension", sets: 3, rr:[12,15] },
      { n: "Calf Raise", sets: 3, rr:[12,20] },
      { n: "Hanging Leg Raises", sets: 3, rr:[10,15] },
    ]},
    { name: "Upper â€” Pull", ex: [
      { n: "Pull Ups", sets: 4, rr:[6,8] },
      { n: "Barbell Row", sets: 3, rr:[8,10] },
      { n: "Seated Cable Row", sets: 3, rr:[10,12] },
      { n: "Lat Pulldown", sets: 3, rr:[8,12] },
      { n: "Curl Bar", sets: 3, rr:[10,12] },
      { n: "Face Pulls", sets: 3, rr:[12,15] },
      { n: "Plank", sets: 3, rr:[45,60] },
    ]},
    { name: "Lower â€” Posterior Chain", ex: [
      { n: "Romanian Deadlift", sets: 4, rr:[6,8] },
      { n: "Hip Thrust", sets: 3, rr:[8,10] },
      { n: "Leg Curl", sets: 3, rr:[12,15] },
      { n: "Bulgarian Split Squat", sets: 3, rr:[10,12] },
      { n: "Calf Raise", sets: 3, rr:[12,20] },
      { n: "Hanging Leg Raises", sets: 3, rr:[10,15] },
    ]},
  ];

  function savePlan(p){ localStorage.setItem(LS_PLAN, JSON.stringify(p)); }
  function loadPlan(){ try{ const r=localStorage.getItem(LS_PLAN); return r? JSON.parse(r): structuredClone(PLAN_DEFAULT); }catch(e){ return structuredClone(PLAN_DEFAULT); } }

  function saveLogs(o){ localStorage.setItem(LS_LOGS, JSON.stringify(o)); }
  function loadLogs(){ try{ const r=localStorage.getItem(LS_LOGS); return r? JSON.parse(r): {}; }catch(e){ return {}; } }

  function getISOWeek(date = new Date()){
    const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
    const dayNum = d.getUTCDay() || 7; d.setUTCDate(d.getUTCDate() + 4 - dayNum);
    const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
    const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    return { year: d.getUTCFullYear(), week: weekNo };
  }
  const today = new Date();
  let weekOffset = 0;
  function weekKey(off=0){ const iso=getISOWeek(new Date(Date.now()+off*7*86400000)); return iso.year+"-W"+iso.week; }

  function suggestionFrom(entries, rr){
    if(!entries || !entries.length) return { cls:"neut", text:"Commence Ã  mi-plage de reps." };
    const last = entries[entries.length-1];
    if(!last.reps) return { cls:"neut", text:"Renseigne tes rÃ©pÃ©titions pour une recommandation." };
    const [mn,mx]=rr;
    if(last.reps >= mx) return { cls:"ok", text:"+2,5 Ã  5% la sÃ©ance suivante." };
    if(last.reps < mn) return { cls:"bad", text:"Sous la plage : -5% ou conserve et vise + reps." };
    return { cls:"warn", text:"Garde la charge, ajoute +1 rep/sÃ©rie." };
  }

  // ---- UI helpers
  function el(html){ const d=document.createElement("div"); d.innerHTML=html.trim(); return d.firstChild; }
  function clear(n){ while(n.firstChild) n.removeChild(n.firstChild); }

  // ---- Tabs
  const tabsEl = document.getElementById("tabs");
  const views = {
    program: document.getElementById("view-program"),
    log: document.getElementById("view-log"),
    advice: document.getElementById("view-advice"),
    export: document.getElementById("view-export"),
  };
  let active = "program";

  function renderTabs(){
    clear(tabsEl);
    TABS.forEach(([k,label])=>{
      const b = el(`<button class="tab">${label}</button>`);
      if(k===active) b.classList.add("active");
      b.addEventListener("click",()=>{ active=k; update(); });
      tabsEl.appendChild(b);
    });
  }

  // ---- Program view
  function renderProgram(){
    const root = views.program; clear(root); root.style.display="block";
    const plan = loadPlan();
    root.appendChild(el(`<div class="row" style="justify-content:space-between"><b>Programme â€” 4 jours</b><span class="pill">Modifie juste les sÃ©ries si besoin</span></div>`));
    plan.forEach((day, dayIdx)=>{
      const card = el(`<div class="card" style="background:#0b152b"><b>Jour ${dayIdx+1} â€” ${day.name}</b></div>`);
      day.ex.forEach((ex, exIdx)=>{
        const row = el(`<div class="tile" style="margin:6px 0">
          <div><div><b>${ex.n}</b></div><div class="small">${ex.rr[0]}â€“${ex.rr[1]} reps</div></div>
          <div class="row"><label>Sets</label><input type="number" value="${ex.sets}" min="1" style="width:90px"/></div>
        </div>`);
        const input = row.querySelector("input");
        input.addEventListener("change",()=>{
          const p = loadPlan(); p[dayIdx].ex[exIdx].sets = Math.max(1, Number(input.value)||1);
          savePlan(p);
          update(); // refresh volumes in advice if needed
        });
        card.appendChild(row);
      });
      root.appendChild(card);
    });
  }

  // ---- Log view
  function renderLog(){
    const root = views.log; clear(root); root.style.display="block";
    const plan = loadPlan();
    const wk = weekKey(weekOffset);
    const head = el(`<div><b>Journal â€” ${wk}</b></div>`);
    const ctrls = el(`<div class="row" style="margin-top:6px">
      <button class="btn">-1 semaine</button>
      <button class="btn">Cette semaine</button>
      <button class="btn">+1 semaine</button>
    </div>`);
    head.appendChild(ctrls);
    root.appendChild(head);

    const [btnPrev, btnCur, btnNext] = ctrls.querySelectorAll("button");
    btnPrev.onclick = ()=>{ weekOffset -= 1; update(); };
    btnCur.onclick = ()=>{ weekOffset = 0; update(); };
    btnNext.onclick = ()=>{ weekOffset += 1; update(); };

    // Display plan with set loggers
    plan.forEach((day, dayIdx)=>{
      const dayCard = el(`<div class="card" style="background:#0b152b"><b>${day.name}</b></div>`);
      day.ex.forEach((ex)=>{
        const exCard = el(`<div class="card" style="background:#0a1326">
          <div class="row" style="justify-content:space-between">
            <div><b>${ex.n}</b><div class="small">Cible ${ex.sets}Ã—${ex.rr[0]}â€“${ex.rr[1]} reps</div></div>
            <div class="small" id="adv"></div>
          </div>
          <div class="grid c4" style="margin-top:8px"></div>
        </div>`);
        const grid = exCard.querySelector(".grid");
        for(let s=1; s<=ex.sets; s++){
          const sb = el(`<div class="setbox">
            <label>Poids (kg)</label><input type="number" step="0.5"/>
            <label>Reps</label><input type="number"/>
            <div class="row" style="margin-top:6px"><button class="btn primary">Ajouter</button></div>
          </div>`);
          const [wInput, rInput] = sb.querySelectorAll("input");
          const addBtn = sb.querySelector("button");
          addBtn.onclick = ()=>{
            const w = Number(wInput.value)||0, r = Number(rInput.value)||0;
            const logs = loadLogs(); const week = logs[wk] || {}; const d = week[dayIdx] || {}; const arr = d[ex.n] || [];
            arr.push({ set:s, weight:w, reps:r, date:(new Date()).toISOString() });
            d[ex.n] = arr; week[dayIdx] = d; logs[wk] = week; saveLogs(logs);
            // update advice live
            const {cls,text} = suggestionFrom(arr, ex.rr);
            const adv = exCard.querySelector("#adv"); adv.textContent = text; adv.className = "small advice "+cls;
          };
          grid.appendChild(sb);
        }
        // initial advice
        const logs = loadLogs(); const arr = (((logs[wk]||{})[dayIdx]||{})[ex.n])||[];
        const {cls,text} = suggestionFrom(arr, ex.rr);
        const adv = exCard.querySelector("#adv"); adv.textContent = text; adv.className = "small advice "+cls;
        dayCard.appendChild(exCard);
      });
      root.appendChild(dayCard);
    });

    root.appendChild(el(`<div class="row"><button class="btn" id="reset">RÃ©initialiser toutes les donnÃ©es</button></div>`));
    root.querySelector("#reset").onclick = ()=>{
      if(confirm("Effacer toutes tes donnÃ©es (programme + logs) ?")){
        localStorage.removeItem(LS_PLAN);
        localStorage.removeItem(LS_LOGS);
        update();
      }
    };
  }

  // ---- Advice view
  function renderAdvice(){
    const root = views.advice; clear(root); root.style.display="block";
    const plan = loadPlan(); const logs = loadLogs();
    const wk = weekKey(weekOffset);
    root.appendChild(el(`<div class="row" style="justify-content:space-between"><b>Conseils â€” ${wk}</b><span class="pill">BasÃ© sur ta derniÃ¨re sÃ©rie saisie</span></div>`));

    plan.forEach((day, dayIdx)=>{
      const dayCard = el(`<div class="card" style="background:#0b152b"><b>${day.name}</b></div>`);
      day.ex.forEach(ex=>{
        const arr = (((logs[wk]||{})[dayIdx]||{})[ex.n])||[];
        const {cls,text} = suggestionFrom(arr, ex.rr);
        const row = el(`<div class="tile"><span>${ex.n}</span><span class="advice ${cls}">${text}</span></div>`);
        dayCard.appendChild(row);
      });
      root.appendChild(dayCard);
    });
  }

  // ---- Export view
  function renderExport(){
    const root = views.export; clear(root); root.style.display="block";
    root.appendChild(el(`<b>Exporter mes donnÃ©es (CSV)</b>`));
    const btns = el(`<div class="row" style="margin-top:6px">
      <button class="btn primary">TÃ©lÃ©charger CSV</button>
    </div>`);
    btns.querySelector("button").onclick = ()=>{
      const logs = loadLogs();
      const rows = [["Week","Day","Exercise","Set","Weight","Reps","Date"]];
      Object.entries(logs).forEach(([wk, days])=>{
        Object.entries(days).forEach(([dIdx, exs])=>{
          Object.entries(exs).forEach(([name, sets])=>{
            sets.forEach(s=> rows.push([wk, Number(dIdx)+1, name, s.set, s.weight, s.reps, s.date]));
          });
        });
      });
      const csv = rows.map(r=>r.join(",")).join("\n");
      const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = "musclepilot_mini_logs.csv"; a.click(); URL.revokeObjectURL(url);
    };
    root.appendChild(btns);
  }

  function hideAll(){ Object.values(views).forEach(v=> v.style.display="none"); }

  function update(){
    renderTabs();
    hideAll();
    if(active==="program") renderProgram();
    if(active==="log") renderLog();
    if(active==="advice") renderAdvice();
    if(active==="export") renderExport();
  }

  // init
  update();
})();
</script>
</body>
</html>
